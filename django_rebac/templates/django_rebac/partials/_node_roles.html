<!-- Embeddable node roles list partial -->
<!-- Include via: {% include "django_rebac/partials/_node_roles.html" with node=node roles=roles %} -->
<!-- Or load via HTMX: hx-get="{% url 'rebac:partial_node_roles' tenant_pk=tenant.pk node_pk=node.pk %}" -->

<div class="node-roles" data-rebac-component="node-roles" data-node-id="{{ node.pk }}">
    {% if roles %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align: left; padding: 0.5rem; border-bottom: 1px solid #e2e8f0; font-size: 0.75rem; text-transform: uppercase; color: #64748b;">User</th>
                <th style="text-align: left; padding: 0.5rem; border-bottom: 1px solid #e2e8f0; font-size: 0.75rem; text-transform: uppercase; color: #64748b;">Role</th>
                {% if can_manage %}
                <th style="text-align: left; padding: 0.5rem; border-bottom: 1px solid #e2e8f0; font-size: 0.75rem; text-transform: uppercase; color: #64748b;">Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for role in roles %}
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #e2e8f0;">
                    {{ role.user.username }}
                    <br><small style="color: #64748b;">{{ role.user.email }}</small>
                </td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #e2e8f0;">
                    <span style="display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px;
                                 font-size: 0.75rem; font-weight: 500;
                                 {% if role.role == 'owner' %}background: #dbeafe; color: #1e40af;
                                 {% elif role.role == 'manager' %}background: #dcfce7; color: #166534;
                                 {% elif role.role == 'viewer' %}background: #f3e8ff; color: #6b21a8;
                                 {% else %}background: #f1f5f9; color: #475569;{% endif %}">
                        {{ role.get_role_display }}
                    </span>
                </td>
                {% if can_manage %}
                <td style="padding: 0.5rem; border-bottom: 1px solid #e2e8f0;">
                    <form method="post" action="{% url 'rebac:remove_role' tenant_pk=tenant.pk node_pk=node.pk role_pk=role.pk %}"
                          style="display: inline;"
                          hx-post="{% url 'rebac:remove_role' tenant_pk=tenant.pk node_pk=node.pk role_pk=role.pk %}"
                          hx-target="closest tr"
                          hx-swap="outerHTML">
                        {% csrf_token %}
                        <button type="submit"
                                style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: #ef4444; color: white;
                                       border: none; border-radius: 4px; cursor: pointer;"
                                onclick="return confirm('Remove this role?')">
                            Remove
                        </button>
                    </form>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #64748b; padding: 1rem; text-align: center;">No role assignments.</p>
    {% endif %}
</div>
